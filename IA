import os
from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_google_search import GoogleSearchAPIWrapper
from langchain.agents import initialize_agent, AgentType, Tool

# --- VERIFICACI√ìN Y CONFIGURACI√ìN ---
# El c√≥digo verificar√° si las claves est√°n configuradas en el entorno.
if not all([os.getenv("GEMINI_API_KEY"), os.getenv("GOOGLE_API_KEY"), os.getenv("GOOGLE_CSE_ID")]):
    raise EnvironmentError(
        "¬°ERROR! Configura las variables de entorno GEMINI_API_KEY, GOOGLE_API_KEY, y GOOGLE_CSE_ID."
    )

# --- INICIALIZACI√ìN DE HERRAMIENTAS ---
search = GoogleSearchAPIWrapper()

google_search_tool = Tool(
    name="Buscador_Google",
    func=search.run,
    description="Una herramienta √∫til para buscar informaci√≥n actual (fechas, noticias, eventos, precios)."
)

tools = [google_search_tool]

# --- INICIALIZACI√ìN DEL AGENTE (EL CEREBRO) ---
llm = ChatGoogleGenerativeAI(model="gemini-2.5-flash", temperature=0)

crono_agente = initialize_agent(
    tools,
    llm,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True, 
    handle_parsing_errors=True,
    # El prompt del sistema le da personalidad a la IA
    agent_kwargs={
        "system_message": (
            "Eres Crono, un asistente de IA experto en b√∫squeda de informaci√≥n actualizada. "
            "Siempre que la pregunta requiera datos en tiempo real o externos, debes usar la herramienta 'Buscador_Google'."
        )
    }
)

# --- FUNCI√ìN DE EJECUCI√ìN ---
def ejecutar_crono(pregunta: str):
    """Env√≠a una pregunta al Agente Crono y devuelve la respuesta."""
    print(f"\n--- üë§ Usuario Pregunta: {pregunta} ---")
    try:
        respuesta = crono_agente.run(pregunta)
        print("\nü§ñ Crono Responde:")
        print(respuesta)
    except Exception as e:
        print(f"\n‚ö†Ô∏è Error al ejecutar Crono: {e}")

# --- PRUEBA DE USO ---
if __name__ == "__main__":
    ejecutar_crono("¬øQui√©n es la persona m√°s rica del mundo seg√∫n la lista m√°s reciente de Forbes?")
    ejecutar_crono("¬øCu√°l es la capital de Alemania?") 
