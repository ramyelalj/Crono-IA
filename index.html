import os
from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_google_search import GoogleSearchAPIWrapper
from langchain.agents import initialize_agent, AgentType, Tool

# ====================================================================
# --- ‚ö†Ô∏è 1. CONFIGURACI√ìN: REEMPLAZA CON TUS CLAVES REALES ‚ö†Ô∏è ---
# ====================================================================

# Es una mala pr√°ctica de seguridad subir claves directamente a GitHub.
# Idealmente, usa variables de entorno o archivos .env, pero para simplificar
# aqu√≠ las establecemos directamente para este script de prueba:
# NOTA: Aseg√∫rate de que estas claves NO se suban a un repositorio p√∫blico.

# Clave del modelo de IA (Gemini)
os.environ["GEMINI_API_KEY"] = "TU_CLAVE_GEMINI_AQU√ç" 

# Claves de la API de B√∫squeda de Google (Google Custom Search API)
os.environ["GOOGLE_API_KEY"] = "TU_CLAVE_API_DE_BUSQUEDA_AQU√ç" 
os.environ["GOOGLE_CSE_ID"] = "TU_ID_DEL_MOTOR_DE_BUSQUEDA_AQU√ç" 

# ====================================================================
# --- 2. FUNCIONALIDAD DEL AGENTE ---
# ====================================================================

try:
    # 2.1. Inicializar la Herramienta de B√∫squeda
    search = GoogleSearchAPIWrapper()
    google_search_tool = Tool(
        name="Buscador_Google",
        func=search.run,
        description="Una herramienta muy √∫til para buscar informaci√≥n actual o en tiempo real (fechas, eventos, precios, etc.)."
    )
    tools = [google_search_tool]

    # 2.2. Inicializar el Modelo de IA (Cerebro)
    llm = ChatGoogleGenerativeAI(model="gemini-2.5-flash", temperature=0)

    # 2.3. Inicializar el Agente (El que decide cu√°ndo usar la herramienta)
    # ZERO_SHOT_REACT_DESCRIPTION permite que el modelo razone sobre qu√© hacer.
    agent = initialize_agent(
        tools,
        llm,
        agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
        verbose=True, # Muestra el proceso de pensamiento del agente
        handle_parsing_errors=True
    )

    # 2.4. Funci√≥n de Pregunta y Respuesta
    def preguntar_ia(pregunta):
        print(f"\n--- üë§ Usuario Pregunta: {pregunta} ---")
        try:
            # El agente ejecuta el proceso completo (decidir, buscar si es necesario, y responder)
            respuesta = agent.run(pregunta)
            print("\nü§ñ IA Responde:")
            print(respuesta)
        except Exception as e:
            print(f"\n‚ö†Ô∏è Ocurri√≥ un error al ejecutar el agente: {e}")

    # ====================================================================
    # --- 3. PRUEBA Y EJECUCI√ìN ---
    # ====================================================================

    print("\n--- ¬°Agente IA con B√∫squeda Activo! ---")
    
    # üí° Prueba 1: Pregunta que requiere B√öSQUEDA en tiempo real
    preguntar_ia("¬øCu√°l es el marcador final del partido de f√∫tbol m√°s reciente de Espa√±a?")

    print("\n---------------------------------------------------------")

    # üí° Prueba 2: Pregunta que NO requiere b√∫squeda (usa conocimiento interno)
    preguntar_ia("¬øQui√©n escribi√≥ la obra 'El Quijote' y d√≥nde naci√≥?")

except EnvironmentError as e:
    print(e)
    print("\nEl programa no puede continuar sin las claves de API configuradas.")
except Exception as e:
    print(f"\nSe encontr√≥ un error cr√≠tico durante la inicializaci√≥n: {e}")

